# zgen
source "${HOME}/.zgen/zgen.zsh"

# check if there's no init script
if ! zgen saved; then
    echo "Creating a zgen save"

    zgen oh-my-zsh

    # plugins
    zgen oh-my-zsh plugins/command-not-found
    zgen oh-my-zsh plugins/colored-man-pages
    zgen oh-my-zsh plugins/docker
    zgen oh-my-zsh plugins/docker-compose
    zgen oh-my-zsh plugins/git
    zgen oh-my-zsh plugins/python
    zgen oh-my-zsh plugins/pyenv
    zgen oh-my-zsh plugins/pip
    zgen oh-my-zsh plugins/ruby
    zgen oh-my-zsh plugins/rbenv
    zgen oh-my-zsh plugins/safe-paste
    zgen oh-my-zsh plugins/sudo
    zgen oh-my-zsh plugins/systemd
    zgen oh-my-zsh plugins/tmux
    zgen oh-my-zsh plugins/z
    zgen load zsh-users/zsh-syntax-highlighting
    zgen load zsh-users/zsh-history-substring-search

    # bulk load
    zgen loadall <<EOPLUGINS
EOPLUGINS
    # ^ can't indent this EOPLUGINS ?

    # completions
    zgen load zsh-users/zsh-completions src

    # theme
    zgen oh-my-zsh themes/clean

    # save all to init script
    zgen save
fi

#platform detection
unamestr=$(uname)

if [[ $unamestr == 'Linux' ]]; then

  export XDG_CONFIG_HOME="$HOME/.config"
  export XDG_CACHE_HOME="$HOME/.cache"
  export XDG_DATA_HOME="$HOME/.local/share"

elif [[ $unamestr == 'Darwin' ]]; then
  #homebrew/nix here if I'm ever back on the mac train
fi

#user and default editor
DEFAULT_USER="jake"
export EDITOR=$(command -v vim)
export VISUAL=$(command -v vim)

# TERM value and tmux auto start
export TERM="xterm-256color" #now uses true color
if [ "$TMUX" = "" ]; then tmux; fi

# check for a command within your path
function command_exists() {
  command -v $1 >/dev/null 2>&1;
}

#Go
if command_exists go ; then
  #TODO fix code/workspace paths across devices and one GOPATH
  #export GOPATH="$HOME/Code/Go"
  #export PATH="$GOPATH/bin:$PATH"
fi

#rbenv
#if [ -d "$HOME/.rbenv/bin" ] ; then
#    #loaded above with zgen, unnecessary? TODO
#    #export PATH="$HOME/.rbenv/bin:$PATH"
#fi

#vi mode with backspace
bindkey -v
bindkey "^?" backward-delete-char #allow backspace to delete behind cursor
bindkey "^A" vi-beginning-of-line #restore ctrl-a to go to beginning while using vim mode in zsh

#load fzf if it exists
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

#yarn globals
if command_exists yarn ; then
  export PATH="$PATH:$HOME/.yarn/bin"
fi

#source aliases
source $HOME/.zsh_aliases

#pyenv TODO loaded by zgen
#export PYENV_ROOT="$HOME/.pyenv"
#export PATH="$PYENV_ROOT/bin:$PATH"
#if command -v pyenv 1>/dev/null 2>&1; then
#  eval "$(pyenv init -)"
#fi

if command_exists cargo ; then
 export PATH="$PATH:$HOME/.cargo/bin"
fi

eval $(thefuck --alias)
