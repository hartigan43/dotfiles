#!/usr/bin/env zsh
# zgen

# TODO move command checks to separate file, same with aliases, source in bashrc
# TODO convert to zplug
source "${HOME}/.zgen/zgen.zsh"

# check if there's no init script
if ! zgen saved; then
    echo "Creating a zgen save"

    zgen oh-my-zsh

    # plugins
    zgen oh-my-zsh plugins/command-not-found
    zgen oh-my-zsh plugins/colored-man-pages
    zgen oh-my-zsh plugins/docker
    zgen oh-my-zsh plugins/docker-compose
    zgen oh-my-zsh plugins/git
    zgen oh-my-zsh plugins/python
    zgen oh-my-zsh plugins/pyenv
    zgen oh-my-zsh plugins/pip
    zgen oh-my-zsh plugins/ruby
    zgen oh-my-zsh plugins/rbenv
    zgen oh-my-zsh plugins/safe-paste
    zgen oh-my-zsh plugins/sudo
    zgen oh-my-zsh plugins/systemd
    zgen oh-my-zsh plugins/tmux
    zgen oh-my-zsh plugins/z
    zgen load zsh-users/zsh-syntax-highlighting
    zgen load zsh-users/zsh-history-substring-search

    # bulk load
    zgen loadall <<EOPLUGINS
EOPLUGINS
    # ^ can't indent this EOPLUGINS ?

    # completions
    zgen load zsh-users/zsh-completions src

    # theme
    zgen oh-my-zsh themes/clean

    # save all to init script
    zgen save
fi

# platform detection
unamestr=$(uname)

if [[ $unamestr == 'Linux' ]]; then

  export XDG_CONFIG_HOME="$HOME/.config"
  export XDG_CACHE_HOME="$HOME/.cache"
  export XDG_DATA_HOME="$HOME/.local/share"
  if [[ -d /usr/local/bin ]]; then
    export XDG_DATA_DIRS="$XDG_DATA_DIRS:/usr/local/bin"
  fi

elif [[ $unamestr == 'Darwin' ]]; then
  #homebrew/nix here if I'm ever back on the mac train
fi

# user and default editor
# override locally with .zsh.lcal
DEFAULT_USER="hartigan"
export EDITOR=$(command -v vim)
export VISUAL=$(command -v vim)
export HISTORY_CONTROL="HIST_IGNORE_DUPES:HIST_EXPIRE_DUPES_FIRST"

# TERM value and tmux auto start
# export TERM="xterm-256color" #now uses true color
export TERM="tmux-256color" #now uses true color
if [ "$TMUX" = "" ]; then tmux; fi

# vi mode with backspace
bindkey -v
bindkey "^?" backward-delete-char #allow backspace to delete behind cursor
bindkey "^A" vi-beginning-of-line #restore ctrl-a to go to beginning while using vim mode in zsh

# source aliases
[ -f $HOME/.aliases.sh ] && source $HOME/.aliases.sh

# allow local machine overrides
[ -f $HOME/.zsh.local ] && source $HOME/.zsh.local

# load fzf if it exists
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
